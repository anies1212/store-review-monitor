format_version: "11"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

app:
  envs:
    # Define shared environment variables here
    # For local testing, set these values
    - SLACK_WEBHOOK_URL: ""
    # - APP_STORE_ISSUER_ID: ""
    # - APP_STORE_KEY_ID: ""
    # - APP_STORE_PRIVATE_KEY: ""
    # - APP_STORE_APP_ID: ""
    # - GOOGLE_PLAY_PACKAGE_NAME: ""
    # - GOOGLE_PLAY_SERVICE_ACCOUNT: ""

workflows:
  # Example: Monitor both App Store and Google Play
  monitor_all:
    steps:
      - git::https://github.com/anies1212/bitrise-step-store-review-monitor.git@main:
          title: Monitor Store Reviews
          inputs:
            # App Store Connect
            - app_store_issuer_id: $APP_STORE_ISSUER_ID
            - app_store_key_id: $APP_STORE_KEY_ID
            - app_store_private_key: $APP_STORE_PRIVATE_KEY
            - app_store_app_id: $APP_STORE_APP_ID
            # Google Play
            - google_play_package_name: $GOOGLE_PLAY_PACKAGE_NAME
            - google_play_service_account: $GOOGLE_PLAY_SERVICE_ACCOUNT
            # Slack
            - slack_webhook_url: $SLACK_WEBHOOK_URL
            - slack_language: "en"

  # Example: Monitor only App Store
  monitor_app_store:
    steps:
      - git::https://github.com/anies1212/bitrise-step-store-review-monitor.git@main:
          title: Monitor App Store Reviews
          inputs:
            - app_store_issuer_id: $APP_STORE_ISSUER_ID
            - app_store_key_id: $APP_STORE_KEY_ID
            - app_store_private_key: $APP_STORE_PRIVATE_KEY
            - app_store_app_id: $APP_STORE_APP_ID
            - slack_webhook_url: $SLACK_WEBHOOK_URL
            - slack_language: "en"

  # Example: Monitor only Google Play
  monitor_google_play:
    steps:
      - git::https://github.com/anies1212/bitrise-step-store-review-monitor.git@main:
          title: Monitor Google Play Reviews
          inputs:
            - google_play_package_name: $GOOGLE_PLAY_PACKAGE_NAME
            - google_play_service_account: $GOOGLE_PLAY_SERVICE_ACCOUNT
            - slack_webhook_url: $SLACK_WEBHOOK_URL
            - slack_language: "en"

  # Example: Using Slack Bot Token instead of Webhook
  monitor_with_bot_token:
    steps:
      - git::https://github.com/anies1212/bitrise-step-store-review-monitor.git@main:
          title: Monitor Store Reviews (Bot Token)
          inputs:
            - app_store_issuer_id: $APP_STORE_ISSUER_ID
            - app_store_key_id: $APP_STORE_KEY_ID
            - app_store_private_key: $APP_STORE_PRIVATE_KEY
            - app_store_app_id: $APP_STORE_APP_ID
            - slack_bot_token: $SLACK_BOT_TOKEN
            - slack_channel: "#app-releases"
            - slack_mentions: "U1234567890,U0987654321"
            - slack_language: "en"

  # Local development and testing
  test:
    steps:
      - path::./:
          title: Test Store Review Monitor
          inputs:
            - app_store_issuer_id: $APP_STORE_ISSUER_ID
            - app_store_key_id: $APP_STORE_KEY_ID
            - app_store_private_key: $APP_STORE_PRIVATE_KEY
            - app_store_app_id: $APP_STORE_APP_ID
            - google_play_package_name: $GOOGLE_PLAY_PACKAGE_NAME
            - google_play_service_account: $GOOGLE_PLAY_SERVICE_ACCOUNT
            - slack_webhook_url: $SLACK_WEBHOOK_URL
            - slack_language: "en"
